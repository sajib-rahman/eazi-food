{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime/helpers/toConsumableArray\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\n\nvar _this = this,\n    _jsxFileName = \"/Users/mdabdurrahman/Desktop/Mobile App/MOBILE APPLICATION PROJECT/PROJECT/P/src/services/cart/CartContext.js\";\n\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport React, { createContext, useContext, useState, useEffect } from 'react';\nimport AsyncStorage from '@react-native-async-storage/async-storage';\nimport { AuthenticationContext } from \"../authentication/AuthenticationContext\";\nexport var CartContext = createContext();\nexport var CartContextProvider = function CartContextProvider(_ref) {\n  var children = _ref.children;\n\n  var _useContext = useContext(AuthenticationContext),\n      user = _useContext.user;\n\n  var _useState = useState([]),\n      _useState2 = _slicedToArray(_useState, 2),\n      cart = _useState2[0],\n      setCart = _useState2[1];\n\n  var _useState3 = useState(0),\n      _useState4 = _slicedToArray(_useState3, 2),\n      sum = _useState4[0],\n      setSum = _useState4[1];\n\n  var _useState5 = useState(null),\n      _useState6 = _slicedToArray(_useState5, 2),\n      restaurant = _useState6[0],\n      setRestaurant = _useState6[1];\n\n  var saveCart = function saveCart(rst, crt, uid) {\n    var jsonValue;\n    return _regeneratorRuntime.async(function saveCart$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.prev = 0;\n            jsonValue = JSON.stringify({\n              restaurant: rst,\n              cart: crt\n            });\n            _context.next = 4;\n            return _regeneratorRuntime.awrap(AsyncStorage.setItem(\"@cart-\" + uid, jsonValue));\n\n          case 4:\n            _context.next = 9;\n            break;\n\n          case 6:\n            _context.prev = 6;\n            _context.t0 = _context[\"catch\"](0);\n            console.log('error saving cart session', _context.t0);\n\n          case 9:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, [[0, 6]], Promise);\n  };\n\n  var loadCart = function loadCart(uid) {\n    var jsonValue, _JSON$parse, rst, crt;\n\n    return _regeneratorRuntime.async(function loadCart$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            _context2.prev = 0;\n            _context2.next = 3;\n            return _regeneratorRuntime.awrap(AsyncStorage.getItem(\"@cart-\" + uid));\n\n          case 3:\n            jsonValue = _context2.sent;\n\n            if (jsonValue !== null) {\n              _JSON$parse = JSON.parse(jsonValue), rst = _JSON$parse.restaurant, crt = _JSON$parse.cart;\n              setRestaurant(rst);\n              setCart(crt);\n            }\n\n            _context2.next = 10;\n            break;\n\n          case 7:\n            _context2.prev = 7;\n            _context2.t0 = _context2[\"catch\"](0);\n            console.log('error loading cart session', _context2.t0);\n\n          case 10:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, [[0, 7]], Promise);\n  };\n\n  useEffect(function () {\n    if (user && user.uid) {\n      loadCart(user.uid);\n    }\n  }, [user]);\n  useEffect(function () {\n    if (user && user.uid) {\n      saveCart(restaurant, cart, user.uid);\n    }\n  }, [restaurant, cart, user]);\n  useEffect(function () {\n    if (!cart.length) {\n      setSum(0);\n      return;\n    }\n\n    var newSum = cart.reduce(function (acc, _ref2) {\n      var price = _ref2.price;\n      return acc += price;\n    }, 0);\n    setSum(newSum);\n  }, [cart]);\n\n  var add = function add(item, rst) {\n    if (!restaurant || restaurant.placeId !== rst.placeId) {\n      setRestaurant(rst);\n      setCart([item]);\n    } else {\n      setCart([].concat(_toConsumableArray(cart), [item]));\n    }\n  };\n\n  var clear = function clear() {\n    setCart([]);\n    setRestaurant(null);\n  };\n\n  return React.createElement(CartContext.Provider, {\n    value: {\n      addToCart: add,\n      clearCart: clear,\n      restaurant: restaurant,\n      cart: cart,\n      sum: sum\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 76,\n      columnNumber: 5\n    }\n  }, children);\n};","map":{"version":3,"sources":["/Users/mdabdurrahman/Desktop/Mobile App/MOBILE APPLICATION PROJECT/PROJECT/P/src/services/cart/CartContext.js"],"names":["React","createContext","useContext","useState","useEffect","AsyncStorage","AuthenticationContext","CartContext","CartContextProvider","children","user","cart","setCart","sum","setSum","restaurant","setRestaurant","saveCart","rst","crt","uid","jsonValue","JSON","stringify","setItem","console","log","loadCart","getItem","parse","length","newSum","reduce","acc","price","add","item","placeId","clear","addToCart","clearCart"],"mappings":";;;;;;;AAAA,OAAOA,KAAP,IAAgBC,aAAhB,EAA+BC,UAA/B,EAA2CC,QAA3C,EAAqDC,SAArD,QAAsE,OAAtE;AACA,OAAOC,YAAP,MAAyB,2CAAzB;AAEA,SAASC,qBAAT;AAEA,OAAO,IAAMC,WAAW,GAAGN,aAAa,EAAjC;AAEP,OAAO,IAAMO,mBAAmB,GAAG,SAAtBA,mBAAsB,OAAkB;AAAA,MAAfC,QAAe,QAAfA,QAAe;;AACnD,oBAAiBP,UAAU,CAACI,qBAAD,CAA3B;AAAA,MAAQI,IAAR,eAAQA,IAAR;;AACA,kBAAwBP,QAAQ,CAAC,EAAD,CAAhC;AAAA;AAAA,MAAOQ,IAAP;AAAA,MAAaC,OAAb;;AACA,mBAAsBT,QAAQ,CAAC,CAAD,CAA9B;AAAA;AAAA,MAAOU,GAAP;AAAA,MAAYC,MAAZ;;AACA,mBAAoCX,QAAQ,CAAC,IAAD,CAA5C;AAAA;AAAA,MAAOY,UAAP;AAAA,MAAmBC,aAAnB;;AAEA,MAAMC,QAAQ,GAAG,SAAXA,QAAW,CAAOC,GAAP,EAAYC,GAAZ,EAAiBC,GAAjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEPC,YAAAA,SAFO,GAEKC,IAAI,CAACC,SAAL,CAAe;AAAER,cAAAA,UAAU,EAAEG,GAAd;AAAmBP,cAAAA,IAAI,EAAEQ;AAAzB,aAAf,CAFL;AAAA;AAAA,6CAGPd,YAAY,CAACmB,OAAb,YAA8BJ,GAA9B,EAAqCC,SAArC,CAHO;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAKbI,YAAAA,OAAO,CAACC,GAAR,CAAY,2BAAZ;;AALa;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAjB;;AASA,MAAMC,QAAQ,GAAG,SAAXA,QAAW,CAAOP,GAAP;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,6CAEWf,YAAY,CAACuB,OAAb,YAA8BR,GAA9B,CAFX;;AAAA;AAEPC,YAAAA,SAFO;;AAGb,gBAAIA,SAAS,KAAK,IAAlB,EAAwB;AAAA,4BACiBC,IAAI,CAACO,KAAL,CAAWR,SAAX,CADjB,EACFH,GADE,eACdH,UADc,EACSI,GADT,eACGR,IADH;AAEtBK,cAAAA,aAAa,CAACE,GAAD,CAAb;AACAN,cAAAA,OAAO,CAACO,GAAD,CAAP;AACD;;AAPY;AAAA;;AAAA;AAAA;AAAA;AASbM,YAAAA,OAAO,CAACC,GAAR,CAAY,4BAAZ;;AATa;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAjB;;AAaAtB,EAAAA,SAAS,CAAC,YAAM;AACd,QAAIM,IAAI,IAAIA,IAAI,CAACU,GAAjB,EAAsB;AACpBO,MAAAA,QAAQ,CAACjB,IAAI,CAACU,GAAN,CAAR;AACD;AACF,GAJQ,EAIN,CAACV,IAAD,CAJM,CAAT;AAMAN,EAAAA,SAAS,CAAC,YAAM;AACd,QAAIM,IAAI,IAAIA,IAAI,CAACU,GAAjB,EAAsB;AACpBH,MAAAA,QAAQ,CAACF,UAAD,EAAaJ,IAAb,EAAmBD,IAAI,CAACU,GAAxB,CAAR;AACD;AACF,GAJQ,EAIN,CAACL,UAAD,EAAaJ,IAAb,EAAmBD,IAAnB,CAJM,CAAT;AAMAN,EAAAA,SAAS,CAAC,YAAM;AACd,QAAI,CAACO,IAAI,CAACmB,MAAV,EAAkB;AAChBhB,MAAAA,MAAM,CAAC,CAAD,CAAN;AACA;AACD;;AAED,QAAMiB,MAAM,GAAGpB,IAAI,CAACqB,MAAL,CAAY,UAACC,GAAD,SAAoB;AAAA,UAAZC,KAAY,SAAZA,KAAY;AAC7C,aAAQD,GAAG,IAAIC,KAAf;AACD,KAFc,EAEZ,CAFY,CAAf;AAIApB,IAAAA,MAAM,CAACiB,MAAD,CAAN;AACD,GAXQ,EAWN,CAACpB,IAAD,CAXM,CAAT;;AAaA,MAAMwB,GAAG,GAAG,SAANA,GAAM,CAACC,IAAD,EAAOlB,GAAP,EAAe;AACzB,QAAI,CAACH,UAAD,IAAeA,UAAU,CAACsB,OAAX,KAAuBnB,GAAG,CAACmB,OAA9C,EAAuD;AACrDrB,MAAAA,aAAa,CAACE,GAAD,CAAb;AACAN,MAAAA,OAAO,CAAC,CAACwB,IAAD,CAAD,CAAP;AACD,KAHD,MAGO;AACLxB,MAAAA,OAAO,8BAAKD,IAAL,IAAWyB,IAAX,GAAP;AACD;AACF,GAPD;;AASA,MAAME,KAAK,GAAG,SAARA,KAAQ,GAAM;AAClB1B,IAAAA,OAAO,CAAC,EAAD,CAAP;AACAI,IAAAA,aAAa,CAAC,IAAD,CAAb;AACD,GAHD;;AAKA,SACE,oBAAC,WAAD,CAAa,QAAb;AACE,IAAA,KAAK,EAAE;AAAEuB,MAAAA,SAAS,EAAEJ,GAAb;AAAkBK,MAAAA,SAAS,EAAEF,KAA7B;AAAoCvB,MAAAA,UAAU,EAAVA,UAApC;AAAgDJ,MAAAA,IAAI,EAAJA,IAAhD;AAAsDE,MAAAA,GAAG,EAAHA;AAAtD,KADT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAGGJ,QAHH,CADF;AAOD,CA1EM","sourcesContent":["import React, { createContext, useContext, useState, useEffect } from 'react';\nimport AsyncStorage from '@react-native-async-storage/async-storage';\n\nimport { AuthenticationContext } from '../authentication/AuthenticationContext';\n\nexport const CartContext = createContext();\n\nexport const CartContextProvider = ({ children }) => {\n  const { user } = useContext(AuthenticationContext);\n  const [cart, setCart] = useState([]);\n  const [sum, setSum] = useState(0);\n  const [restaurant, setRestaurant] = useState(null);\n\n  const saveCart = async (rst, crt, uid) => {\n    try {\n      const jsonValue = JSON.stringify({ restaurant: rst, cart: crt });\n      await AsyncStorage.setItem(`@cart-${uid}`, jsonValue);\n    } catch (err) {\n      console.log('error saving cart session', err);\n    }\n  };\n\n  const loadCart = async (uid) => {\n    try {\n      const jsonValue = await AsyncStorage.getItem(`@cart-${uid}`);\n      if (jsonValue !== null) {\n        const { restaurant: rst, cart: crt } = JSON.parse(jsonValue);\n        setRestaurant(rst);\n        setCart(crt);\n      }\n    } catch (err) {\n      console.log('error loading cart session', err);\n    }\n  };\n\n  useEffect(() => {\n    if (user && user.uid) {\n      loadCart(user.uid);\n    }\n  }, [user]);\n\n  useEffect(() => {\n    if (user && user.uid) {\n      saveCart(restaurant, cart, user.uid);\n    }\n  }, [restaurant, cart, user]);\n\n  useEffect(() => {\n    if (!cart.length) {\n      setSum(0);\n      return;\n    }\n\n    const newSum = cart.reduce((acc, { price }) => {\n      return (acc += price);\n    }, 0);\n\n    setSum(newSum);\n  }, [cart]);\n\n  const add = (item, rst) => {\n    if (!restaurant || restaurant.placeId !== rst.placeId) {\n      setRestaurant(rst);\n      setCart([item]);\n    } else {\n      setCart([...cart, item]);\n    }\n  };\n\n  const clear = () => {\n    setCart([]);\n    setRestaurant(null);\n  };\n\n  return (\n    <CartContext.Provider\n      value={{ addToCart: add, clearCart: clear, restaurant, cart, sum }}\n    >\n      {children}\n    </CartContext.Provider>\n  );\n};\n"]},"metadata":{},"sourceType":"module"}